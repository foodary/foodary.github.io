<!DOCTYPE html>
<html>
  <head>
    <title>Place searches</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <script src="js/jQuery.min.js"></script>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/test.css">
    <script src="https://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js" type="text/javascript"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>
    <script>
      navigator.geolocation.getCurrentPosition( success, fail );
      function success(position)
      {
        var longitude = position.coords.longitude;
        var latitude = position.coords.latitude;
        text = latitude+","+longitude;
        alert(distance(latitude,35.130398,longitude,-80.71169500000001));
        sende(text);
      }
      function createRequestObject() {
        var o;     
        o = (window.ActiveXObject) ? new ActiveXObject("Microsoft.XMLHTTP") : new XMLHttpRequest();
        return o;
      }
      var http = createRequestObject(); 
      function sende(text) {
        http.open('get', 'http://foodary.herokuapp.com/action_answer_placelist.php?action='+text);
        http.onreadystatechange = handleResponse;
        http.send(null);
      }
      function handleResponse() {
        if(http.readyState == 4){
          var response = http.responseText;
          //      document.writeln(response);
          var str = response;
          final = str.split(";");
          var myStringArray = final;
          var arrayLength = myStringArray.length;
          for (var i = 0; i < arrayLength-1; i++) {
            var address = myStringArray[i].split("`");
            var image = address[1].split("~");
            var loc = image[0].split("ccc");
            $(".jumbotron").append("<div class=\"card "+i+"\"><h1>"+address[0]+"</h1><div class=\""+i+"details\"><h3>"+loc[0]+"</h3></div><br><a href=\""+loc[1]+"\" target=\"blank\"><button class=\"btn-default btn img-circle\" style=\"color:#0F0\"><i class=\"fa fa-thumbs-up\" style=\"font-size:36px\"></i></button></a> <button class=\"btn-default btn img-circle\" style=\"color:#00F\" onclick=\"details("+i+")\"><i class=\"fa fa-ellipsis-h\" style=\"font-size:36px\"></i></button> <button class=\"btn-default btn img-circle\" style=\"color:#F00\" onclick=\"no("+i+")\"><i class=\"fa fa-thumbs-down\" style=\"font-size:36px\"></i></button></div>");
            $("."+i).hide();
            $("."+i+"details").hide();
            $(".0").show();
            if(i==arrayLength-1)
            {
              alert("Sorry, that's all we got");
            }
          }
        }
      }
      $(".hide").hide();
      function details(num)
      {
        $("."+num+"details").toggle();
      }
      function no(num)
      { 
        $("."+num).fadeOut(0);
        $("."+(num+1)).fadeIn();
      }
      function fail()
      {
        alert("Oops something went wrong. Please check your device's location settings");
      }
      function distance(lat1, lon1, lat2, lon2, unit) {
    theta = lon1 - lon2;
    dist = sin(deg2rad(lat1)) * sin(deg2rad(lat2)) +  cos(deg2rad(lat1)) * cos(deg2rad(lat2)) * cos(deg2rad(theta));
    dist = acos(dist);
    dist = rad2deg(dist);
    miles = dist * 60 * 1.1515;
    unit = strtoupper(unit);
    return miles;
  }
  function deg2rad(angle){
    return angle * (Math.PI / 180);
  }
    </script>
  </head>
  <body>
    <div class="jumbotron" id="main" align="center" style="background:#FFF">
    </div>
    <img src="img/powered-by-google-on-white.png">
  </body>
</html>
